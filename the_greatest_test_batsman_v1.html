<!DOCTYPE html>
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> 

	circle {fill: lightblue; stroke: black;} 
	body {
            font-family: "Arial", sans-serif;
        }
        
        .bar {
            fill: #5f89ad;
        }
        
        .axis {
            font-size: 13px;
        }
        
        .axis path,
        .axis line {
            fill: none;
            display: none;
        }
        
        .label {
            font-size: 13px;
        }

</style>

<!--<body onload='init()'>-->
<body onload ="byCriteria()">

<div class="text-things">
    <h1> Who is the greatest test batsman?</h1>
    <h2> It depends on the criteria you apply...</h2>    
</div>

<!-- Create a div where the button will reside -->
<!--<div class="buttons">
    <button value = "byHundredRun" onclick="byRunsHundreds()">By runs & hundreds scored</button>   
	<button value = "byHundredRunAvg" onclick="byAvgRunsHundreds()">By avg, runs & hundreds scored</button> 
	<button value = "byAll" onclick="byAll()">By conversion, avg, runs & hundreds scored</button> 
</div>-->

<!-- Initialize a select button -->
<div>
	<select id="selectButton"></select>
</div>

<!-- Create a div where the graph will take place -->
<div id="my_chart"></div>

<!--<svg width=960 height=600></svg>-->

<script>

async function byCriteria() {

 //default value of criteria onload(); will asume value on button onclick()
 var selectedCriteria = "byHundredRun"
 
 // set the dimensions and margins of the graph
 var margin = {top: 25, right: 25, bottom: 25, left: 50},
    width = 960 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

 //use log scale for both x & y -axis

 //Color of the circle indicates the run scored by a batsman
 var x = d3.scaleLinear().domain([4794,15921]).range([0,width]); //Runs scale
 var y = d3.scaleLinear().domain([4,51]).range([height,0]); //hundreds scale
 //var c = d3.scaleLinear().domain([20,60,100]).range(["red","white","green"]); 
 var c = d3.scaleSequential().domain([9,70]).interpolator(d3.interpolatePuRd);//Conversion scale - color of the bubble
 var r = d3.scaleLinear().domain([20,100]).range([0,25]);  //Average scale - radius of the bubble

 var bubbleRadius = function(criteria,d) {
		if (criteria == "byHundredRun") {
			return r(40);
		} else { 
			return r(d);
		}
 
    }
  var bubbleColor = function(criteria,d) {
		if (criteria == "byAll") {
			return c(d);
		} else {
			return d3.color("lightgreen");
			//return c(d);
		}
 
    }


 //d3.select("svg").selectAll("*").remove();
 
 // append the svg object to the body of the page
 var svg = d3.select("#my_chart")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
		  
  const data = await d3.csv(
  'https://amarroyds.github.io/ICC_Test_Batting_Figures.csv');
  //console.log(data);

  // List of groups (here I have one group per column)
  var allGroup = ["byHundredRun", "byHundredRunAvg", "byAll"]
  
  // add the options to the button
  d3.select("#selectButton")
    .selectAll('myOptions')
    .data(allGroup)
    .enter()
    .append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }) // corresponding value returned by the button

 


  //svg.append("g")
  // .attr("transform","translate("+margin.left+","+margin.top+")")
   
   
   // add Y-axis
   svg.append("g")
	.call(d3.axisLeft(y).tickValues([5,15,25,35,45]).tickFormat(d3.format("~s")));
   
   //add X-axis
   svg.append("g")
	.attr("transform","translate(0,"+height+")")
	.call(d3.axisBottom(x).tickValues([5000,7500,10000,12500,15000]).tickFormat(d3.format("~s")));
	
   // Add a tooltip div. Here I define the general feature of the tooltip: stuff that do not depend on the data point.
   // Its opacity is set to 0: we don't see it by default.
   var tooltip = d3.select("#my_chart")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "1px")
    .style("border-radius", "5px")
    .style("padding", "10px")
   
   // A function that change this tooltip when the user hover a point.
   // Its opacity is set to 1: we can now see it. Plus it set the text and position of tooltip depending on the datapoint (d)
   var mouseover = function(d) {
     tooltip
      .style("opacity", 1)
   }

   var mousemove = function(d) {
    tooltip
      .html("Player: " + d.Player)
      .style("left", (d3.mouse(this)[0]+90) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
      .style("top", (d3.mouse(this)[1]) + "px")
   }

   // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again
   var mouseleave = function(d) {
    tooltip
      .transition()
      .duration(200)
      .style("opacity", 0)
   }

   svg.selectAll('circle')
   .data(data)
   .enter()
    .append('circle')
      .attr('cx', function (d,i) { return x(d.Runs); })
      .attr('cy', function (d,i) { return y(d.Hundred);})
      .attr('r', function(d,i) {return bubbleRadius(selectedCriteria,d.Avg);})
	  .style("fill", function(d,i) {return bubbleColor(selectedCriteria,d.conversion_pct);});

   
   
   // A function that update the chart
    function update(selectedCriteria) {

      // Create new data with the selection?
      //var dataFilter = data.map(function(d){return {time: d.time, value:d[selectedGroup]} })
	  
	  console.log(selectedCriteria);

      // Redraw the circles based on the selected criteria i.e. button values
	  svg.selectAll('circle')
         .data(data)
		 .transition()
         .duration(1000)
			.attr('cx', function (d,i) { return x(d.Runs); })
			.attr('cy', function (d,i) { return y(d.Hundred);})
            .attr('r', function(d,i) {return bubbleRadius(selectedCriteria,d.Avg);})
			.style("fill", function(d,i) {return bubbleColor(selectedCriteria,d.conversion_pct);});

    }
	
	// When the button is changed, run the updateChart function
    d3.select("#selectButton")
	.on("change", function(d) {
	
        // recover the option that has been chosen
        var selectedOption = d3.select(this).property("value");
		
		console.log(selectedOption);
		
        // run the updateChart function with this selected option
        update(selectedOption);
		
    });
}
</script>
<div id="contacts">

	<h3> Please contact Amar Roy for mordetails...</h3>

</div>
</body>
</html>